{extend name="public/base" /}
{block name="css"}
<style type="text/css">
    .table tbody tr.active,.table tbody tr.active>td,.table tbody tr.active>th,.table tbody tr .active{background-color:#F5F5F5!important}
    label.error{top:12px;}
    .input-text[type="number"]{width:100%;}
    .teacher-info-hide{display: none;}
    #token-error{right:47px;}
</style>
{/block}

{block name="body"}
<article class="page-container" style="padding:0;">
    <form class="form form-horizontal" id="form-menu-add" action="" method="post">
        <input type="hidden" name="id" value="<?php echo $id;?>">
        <input type="hidden" name="name" value="<?php echo $name;?>">
        <table class="table table-border table-bg table-bordered layer-table">
            <tbody>
            <tr>
                <th class="title">用户ID</th>
                <td width="160"><?php echo empty($id) ? '' : $id;?></td>
                <th class="title">修改类型</th>
                <td width="240px;">
                    <span class="select-box" style="width:200px;">
                    <select class="select" id="opt_type" name="opt_type">
                        <option value="">选择修改类型</option>
                        <?php foreach($updateTypes as $k=>$v):?>
                            <option value="<{$k}>" ><{$v}></option>
                        <?php endforeach;?>
                    </select>
                    </span>
                </td>
            </tr>
            <tr>
                <th class="title">修改数值</th>
                <td colspan="3">
                    <input type="text" class="input-text" name="opt_val" id="opt_val" style="position: relative;width:300px;">
                    <div id="on-show" class="f-12 c-warning">(正数表示加，负数表示减,红包券,vip点数和摇钱树点数单位为分)</div>
                </td>
            </tr>

            <tr>
                <th class="title">操作原因</th>
                <td colspan="3">
                    <textarea class="textarea valid" name="reason" id="reason"></textarea>
                </td>
            </tr>

            <tr class="form-btn">
                <td colspan="4">
                    <input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
                </td>
            </tr>

            </tbody>

        </table>
    </form>
</article>
{/block}


{block name="javascript"}
<script type="text/javascript" src="__LIB__/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript">
    var selectRoleId = 0;
    $(function(){
        $('#role-id').on('change',function(){
            selectRoleId = $(this).val();
            if($(this).val() == 4){
                console.log($(this).val());
                $('.teacher-info').show();
            }else{
                $('.teacher-info').hide();
            }

        });

        $("#form-menu-add").validate({
            rules:{
                opt_type:{
                    required:true
                },
                opt_val:{
                    required:true,
                    number:true
                },
                reason:{
                    required:true
                }
            },messages: {
                opt_type: {
                    required: ''
                },
                opt_val: {
                    required: '请输入修改数值!',
                    number:'请输入正确的数字'
                },
                reason: {
                    required: '请输入操作原因!'
                }
            },
            onkeyup:false,
            focusCleanup:false,
            success:"valid",
            submitHandler:function(form){
                $(form).ajaxSubmit({beforeSend: function(){
                    loading_show('提交中...');
                },success:function(data){
                    if(data.status == 'y'){
                        parent.layer.msg(data.msg,{time:1500,icon:1},function(){
                            parent.location.reload();
                        });
                        return false;
                    }else{
                        parent.layer.msg(data.msg,{icon:5});
                    }
                },complete:function () {
                    loading_hide();
                }
                });

            }
        });


    });


    function makeToken() {
        var randomStr = "1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJLKMNOPQRSTUVWXYZ";
        var randomLen = randomStr.length;
        var len = 10;
        var str = '',index=0;
        for(var i=0;i<len;i++){
            index = Math.floor(Math.random()*randomLen);
            str += randomStr.substr(index,1);
        }
        $('#token').val(str);
    }
</script>
{/block}