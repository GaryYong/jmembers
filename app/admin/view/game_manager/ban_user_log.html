{extend name="public/base" /}

{block name="css"}
<style type="text/css">
.Wdate {
    background: #fff url(__LIB__/My97DatePicker/skin/datePicker.gif) no-repeat right;
}
</style>
{/block}
{block name="body"}
<{:get_page_nav()}>

<div class="page-container">

    <form method="get" action="">
        <div class="text-c">
            ID：<input type="text" class="input-text" name="id" value="<?php echo isset($_GET['id']) ? $_GET['id'] : ''?>" style="width:180px;">
            <span class="select-box" style="width:200px;">
            <select class="select" name="ban_type">
                <option value="">选择惩罚类型</option>
                <?php foreach($updateTypes as $k=>$v):?>
                    <option value="<{$k}>" <?php if(isset($_GET['ban_type']) && $_GET['ban_type'] == $k):?>selected="selected"<?php endif;?> ><{$v}></option>
                <?php endforeach;?>
            </select>
            </span>
            <button type="submit" class="btn btn-success" id="" name=""><i class="Hui-iconfont">&#xe665;</i> 查询</button>
        </div>
    </form>


    <div class="cl pd-5 bg-1 bk-gray mt-20">
        <span class="l">

        </span>
    </div>
    <table class="table table-border table-bordered table-bg">
        <thead>
        <tr class="text-c">
            <th>用户ID</th>
            <th>昵称</th>
            <th>惩罚类型</th>
            <th>惩罚原因</th>
            <th>开始时间</th>
            <th>结束时间</th>
            <th>状态</th>
            <th>操作员</th>
            <th>操作时间</th>
        </tr>
        </thead>
        <tbody>
        <?php if($data):?>
            <?php foreach($data as $k=>$v):?>
            <tr class="text-c">
                <td><?php echo $v['user_id']?></td>
                <td><?php echo $v['user_name']?></td>
                <td>
                    <?php echo $v['opt_val'] == 1 ? '' : '解除';?>
                    <?php echo isset($updateTypes[$v['opt_type']]) ? $updateTypes[$v['opt_type']] : ''?>
                </td>

                <?php if($v['opt_val'] > 1000):?>
                    <td><{$v.add_time|date="Y-m-d H:i:s",###}></td>
                    <td><{$v.opt_val|date="Y-m-d H:i:s",###}></td>
                <?php else:?>
                    <td></td>
                    <td></td>
                <?php endif;?>

                <td><?php echo $v['reason']?></td>
                <td>

                <?php

                    if($v['opt_type'] == 2){

                        if($v['opt_val'] > 1000){
                            if($v['opt_val'] > $time){
                                echo "未结束";
                            }else{
                                echo "已结束";
                            }
                        }else{
                            echo "-";
                        }
                    }else if($v['opt_type'] == 3){
                        if($v['opt_val'] == 0){
                            echo "已结束";
                        }else{
                            echo "未结束";
                        }
                    }
                    ?>
                </td>
                <td><{$v.admin_uid|get_admin_name}></td>
                <td><{$v.add_time|date="Y-m-d H:i:s",###}></td>
            </tr>
            <?php endforeach;?>
        <?php endif;?>
        </tbody>
    </table>
    <div class="dataTables_wrapper no-footer">
        <{$page}>
    </div>
</div>
{/block}


{block name="javascript"}

<script type="text/javascript" src="__LIB__/laydate/laydate.js"></script>

<script type="text/javascript">

    $(function () {
        laydate.render({
            elem: '#start-date' //指定元素
        });
    })


    function del_user(id,msg){
        if(!id){return false;}
        layer.confirm(msg,function(){
            $.ajax({
                url:'<{:URL("User/ajax_delete")}>',
                type:'POST',
                dataType:'json',
                data:{'id':id},
                success:function(data){
                    if(data.status == 'y'){
                        layer.msg(data.msg,{icon:1},function(){
                            window.location.reload();
                        });
                    }else{
                        layer.msg(data.msg,{icon:5});
                    }
                },
                error:function(){
                    layer.msg('服务器错误',{icon:5});
                }
            });
        });
    }
</script>
{/block}