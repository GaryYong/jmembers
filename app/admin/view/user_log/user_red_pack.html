{extend name="public/base" /}

{block name="css"}
<style type="text/css">
.task-table tr th,.task-table tr td{text-align: center;}
.table td{text-align: center;}
</style>

{/block}

{block name="body"}
<{:get_page_nav()}>

<div class="page-container">

    <form method="get" action="">
        <div class="text-c">
            <input type="text" id="user_id" name="user_id" value="<?php echo isset($_GET['user_id']) ? $_GET['user_id'] : ''?>" class="input-text" style="width:180px;">
            <button type="submit" class="btn btn-success" name="do_submit" onclick="return dosubmit();"><i class="Hui-iconfont">&#xe665;</i> 查询</button>
        </div>
    </form>


    <div class="cl pd-5 bg-1 bk-gray mt-20">
        <span class="l">

        </span>
    </div>
    <table class="table table-border table-bg table-bordered">
        <thead>
        <tr class="text-c">
            <th>用户id</th>
            <th>红包来源</th>
            <th>红包数量</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <?php if(is_string($data)):?>
            <tr>
                <td colspan="5"><?php echo $data;?></td>
            </tr>
        <?php elseif($data):?>
            <?php foreach($data as $k=>$v):?>
            <tr>
                <td><?=$v['actorid']?></td>
                <td><?=isset($sourceType[$v['source']]) ? $sourceType[$v['source']] : '未知';?></td>
                <td><?=$v['num']?></td>
                <td><a class="btn" href="javascript:ajax_del_user_readpack('<?=$v['actorid'];?>','<?=$v['source'];?>','<?=$v['num']?>');">删除</a></td>
            </tr>
            <?php endforeach;?>

        <?php endif;?>
        </tbody>
    </table>
</div>
{/block}

{block name="javascript"}
<script type="text/javascript" src="__LIB__/laydate/laydate.js"></script>
<script type="text/javascript">
function do_del(url,params){
    layer.confirm('确认要删除吗？',function(index){
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data:params,
            success: function(data){
                if(data.status == 'y'){
                    layer.msg(data.msg,{time:1500,icon:1},function(){
                        window.location.reload();
                    });
                }else{
                    layer.msg(data.msg,{icon:5});
                }
            },
            error:function(data) {
                console.log(data.msg);
            },
        });
    });
}

$(function () {
    laydate.render({
        elem: '#start-date' //指定元素
        ,type:'date'
    });
});


function ajax_del_user_readpack(user_id,source,num) {
    layer.confirm('确定删除?', function(index){
        $.ajax({
            url:'ajax_del_user_readpack',
            type:'post',
            dataType:'json',
            data:{"user_id":user_id,"source":source,"num":num},
            success:function (data) {
                layer.msg('删除成功');
                window.location.reload();
            },error(err){
                layer.msg('服务器请求超时');
            }
        });
        layer.close(index);
    });
}


function dosubmit() {
    var user_id = $('#user_id').val();
    if(!user_id){
        layer.msg('请输入用户id');
        return false;
    }
    loading_show('查询中...');
    return true;
}    
</script>
{/block}