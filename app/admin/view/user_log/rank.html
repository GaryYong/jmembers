{extend name="public/base" /}

{block name="css"}
<style type="text/css">
.task-table tr th,.task-table tr td{text-align: center;}
.table td{text-align: center;}
</style>

{/block}

{block name="body"}
<{:get_page_nav()}>

<div class="page-container">

    <form method="get" action="">
        <div class="text-c">
            <span class="select-box" style="width:200px;">
            <select class="select" id="search_type" name="search_type">
                <option value="">榜单类型</option>
                <?php foreach($rankTypes as $k=>$v):?>
                    <option value="<{$k}>" <?php if(isset($_GET['search_type']) && $_GET['search_type'] == $k):?>selected="selected"<?php endif;?>><{$v}></option>
                <?php endforeach;?>
            </select>
            </span>
            <input type="text" id="start-date" name="start_date" value="<?php echo isset($_GET['start_date']) ? $_GET['start_date'] : ''?>" class="input-text Wdate" style="width:180px;">
            <button type="submit" class="btn btn-success" name="do_submit" onclick="return dosubmit();"><i class="Hui-iconfont">&#xe665;</i> 查询</button>
        </div>
    </form>


    <div class="cl pd-5 bg-1 bk-gray mt-20">
        <span class="l">

        </span>
    </div>
    <table class="table table-border table-bg table-bordered">
        <thead>
        <tr class="text-c">
            <th>排名</th>
            <th>ID</th>
            <th>是否机器人</th>
            <th>昵称</th>
            <th>VIP等级</th>
            <th>注册渠道</th>
            <th>
                <?=$table_title?>
            </th>
        </tr>
        </thead>
        <tbody>
        <?php if(is_string($data)):?>
            <tr>
                <td colspan="5"><?php echo $data;?></td>
            </tr>
        <?php elseif($data):?>
            <?php foreach($data as $k=>$v):?>
            <tr>
                <td><?php echo $v['rank'];?></td>
                <td><?php echo $v['actorid'];?></td>
                <td><?php echo empty($v['robot']) ? '玩家' : '机器人';?></td>
                <td><?php echo $v['name'];?></td>
                <td><?php echo $v['vip'];?></td>
                <td><?php echo isset($channel_list[$v['channel']]) ? $channel_list[$v['channel']] : $v['channel'];?></td>
                <td>
                    <?php
                            if(isset($_GET['search_type']) && in_array($_GET['search_type'],[5,6,7])){
                                echo empty($v['rankvalue']) ? number_format(intval($v['money'])/100) : $v['rankvalue']/100;
                            }else{
                                echo empty($v['rankvalue']) ? number_format(intval($v['money'])) : $v['rankvalue'];
                            }
                    ?>
                </td>
            </tr>
            <?php endforeach;?>

        <?php endif;?>
        </tbody>
    </table>
</div>
{/block}

{block name="javascript"}
<script type="text/javascript" src="__LIB__/laydate/laydate.js"></script>
<script type="text/javascript">
function show_layer_btn(title,url,w,h) {
    if (title == null || title == '') {
        title=false;
    };
    if (url == null || url == '') {
        url="404.html";
    };
    if (w == null || w == '') {
        w=800;
    };
    if (h == null || h == '') {
        h=($(window).height() - 50);
    };
    layer.open({
        type: 2,
        area: [w+'px', h +'px'],
        fix: false, //涓嶅浐瀹�
        maxmin: true,
        shade:0.4,
        title: title
        ,btn: ['提交','取消']
        ,yes: function(index, layero){
            //按钮【按钮一】的回调
            var body = layer.getChildFrame('body', index);
            var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
            //console.log(body.html()) //得到iframe页的body内容
            body.find('#do-submit').click();
        }
        ,btn2: function(index, layero){
            //按钮【按钮二】的回调
            //return false 开启该代码可禁止点击该按钮关闭
        },
        content: url
    });
}


function do_del(url,params){
    layer.confirm('确认要删除吗？',function(index){
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data:params,
            success: function(data){
                if(data.status == 'y'){
                    layer.msg(data.msg,{time:1500,icon:1},function(){
                        window.location.reload();
                    });
                }else{
                    layer.msg(data.msg,{icon:5});
                }
            },
            error:function(data) {
                console.log(data.msg);
            },
        });
    });
}

$(function () {
    laydate.render({
        elem: '#start-date' //指定元素
        ,type:'date'
    });
})


function dosubmit() {
    var search_type = $('#search_type').find('option:selected').val();
    if(!search_type){
        layer.msg('请选择榜单类型');
        return false;
    }
    var start_date = $('#start-date').val();
    if(!start_date){
        layer.msg('请输入时间');
        return false;
    }
    loading_show('查询中...');
    return true;
}    
</script>
{/block}