{extend name="public/base" /}

{block name="css"}
<style type="text/css">
.task-table tr th,.task-table tr td{text-align: center;}
.table td{text-align: center;}
</style>

{/block}

{block name="body"}
<{:get_page_nav()}>

<div class="page-container">

    <form method="get" action="">
        <div class="text-c">
            <span class="select-box" style="width:200px;">
            <select class="select" id="search_type" name="search_type">
                <option value="">搜索类型</option>
                <?php foreach($searchMailTypes as $k=>$v):?>
                    <option value="<{$k}>" <?php if(isset($_GET['search_type']) && $_GET['search_type'] == $k):?>selected="selected"<?php endif;?>><{$v}></option>
                <?php endforeach;?>
            </select>
            </span>
            <input type="text" name="key" id="key" value="<?php echo isset($_GET['key']) ? $_GET['key'] : '';?>" class="input-text" style="width:160px;">
            <button type="submit" class="btn btn-success" name="do_submit" onclick="return dosubmit();"><i class="Hui-iconfont">&#xe665;</i> 查询</button>
        </div>
    </form>


    <div class="cl pd-5 bg-1 bk-gray mt-20">
        <span class="l">

        </span>
    </div>
    <table class="table table-border table-bg table-bordered">
        <thead>
        <tr class="text-c">
            <th>邮件id</th>
            <th>类型</th>
            <th>标题</th>
            <th>内容</th>
            <th>发件人id</th>
            <th>收件人id</th>
            <th>邮件奖励</th>
            <th>发送时间</th>
            <th>状态</th>
            <th>领取状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <?php if(is_string($data)):?>
        <tr class="text-c">
            <td colspan="11">
                <?php echo $data;?>
            </td>
        </tr>
        <?php elseif(isset($data['maillist'])):?>
        <?php foreach($data['maillist'] as $mail):?>
        <tr>
            <td><?php echo $mail['id'];?></td>
            <td><?php echo $mailTypes[$mail['type']];?></td>
            <td width="160"><?php echo $mail['title'];?></td>
            <td width="260"><?php echo $mail['content'];?></td>
            <td><?php echo $mail['senderID'];?></td>
            <td><?php echo $mail['receiverID'];?></td>
            <td><?php echo $mail['extra'];?></td>
            <td><?php echo date('Y-m-d H:i:s',$mail['time']);?></td>
            <td><?php echo $mail['read'] ? '<span class="c-warning">已读</span>' : '<span class="c-green">未读</span>';?></td>
            <td><?php echo $mail['fetch'] ? '<span class="c-warning">已领取</span>' : '<span class="c-green">未领取</span>';?></td>
            <td>
                <a href="javascript:del_mail('<?php echo $mail['id'];?>');">删除</a>
            </td>
        </tr>
        <?php endforeach;?>
        <?php endif;?>
        </tbody>
    </table>
    <div>
        <?php echo $page;?>
    </div>
</div>
{/block}

{block name="javascript"}
<script type="text/javascript">
function show_layer_btn(title,url,w,h) {
    if (title == null || title == '') {
        title=false;
    };
    if (url == null || url == '') {
        url="404.html";
    };
    if (w == null || w == '') {
        w=800;
    };
    if (h == null || h == '') {
        h=($(window).height() - 50);
    };
    layer.open({
        type: 2,
        area: [w+'px', h +'px'],
        fix: false, //涓嶅浐瀹�
        maxmin: true,
        shade:0.4,
        title: title
        ,btn: ['提交','取消']
        ,yes: function(index, layero){
            //按钮【按钮一】的回调
            var body = layer.getChildFrame('body', index);
            var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();
            //console.log(body.html()) //得到iframe页的body内容
            body.find('#do-submit').click();
        }
        ,btn2: function(index, layero){
            //按钮【按钮二】的回调
            //return false 开启该代码可禁止点击该按钮关闭
        },
        content: url
    });
}


function del_mail(id){
    layer.confirm('确认要删除吗？',function(index){
        $.ajax({
            type: 'POST',
            url: '<{:url("Game/ajax_del_mail")}>',
            dataType: 'json',
            data:{id:id},
            success: function(data){
                if(data.status == 'y'){
                    layer.msg(data.msg,{time:1500,icon:1},function(){
                        window.location.reload();
                    });
                }else{
                    layer.msg(data.msg,{icon:5});
                }
            },
            error:function(data) {
                layer.msg('服务器超时',{icon:5});
            },
        });
    });
}

function dosubmit() {
    var search_type = $('#search_type').find('option:selected').val();
    if(!search_type){
        layer.msg('请选择搜索类型');
        return false;
    }
    var start_date = $('#key').val();
    if(!start_date){
        layer.msg('请输入搜索内容');
        return false;
    }
    loading_show('查询中...');
    return true;
}

</script>
{/block}